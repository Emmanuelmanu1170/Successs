<!DOCTYPE html>
<html>
<head>
  <title>Kwabenamedia - Order Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: green;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    select, input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: green;
      color: white;
      padding: 12px;
      width: 100%;
      border: none;
      margin-top: 15px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: darkgreen;
    }
    .history-btn {
      background: #555;
      margin-top: 10px;
    }
    .history-btn:hover {
      background: #333;
    }
    .price-box {
      margin-top: 10px;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Place Your Order</h2>

  <label>Platform</label>
  <select id="platform">
    <option value="">-- Select Platform --</option>
    <option value="TikTok">TikTok</option>
    <option value="Instagram">Instagram</option>
    <option value="YouTube">YouTube</option>
    <option value="Telegram">Telegram</option>
    <option value="Facebook">Facebook</option>
    <option value="WhatsApp">WhatsApp</option>
    <option value="LinkedIn">LinkedIn</option>
  </select>

  <label>Service</label>
  <select id="service">
    <option value="">-- Select Service --</option>
  </select>

  <label>Quantity (Per 1000)</label>
  <input type="number" id="quantity" value="1" min="1">

  <div class="price-box">
    <p><strong>Price in GHS:</strong> <span id="priceGHS">0</span></p>
    <p><strong>Price in USD:</strong> <span id="priceUSD">0</span></p>
  </div>

  <label>Username / Link</label>
  <input type="text" id="username" required>

  <label>Email</label>
  <input type="email" id="email" required>

  <label>Phone</label>
  <input type="text" id="phone" required>

  <button onclick="payWithPaystack()">Place Order & Pay</button>
  <button class="history-btn" onclick="window.location.href='order_history.html'">Order History</button>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
const prices = {
  TikTok: { Followers: [35, 3], Likes: [35, 3], Views: [22, 2] },
  Instagram: { Followers: [40, 4], Likes: [25, 2], Views: [30, 3] },
  YouTube: { Views: [40, 4], Likes: [25, 2.5], Subscribers: [50, 5] },
  Telegram: { Members: [40, 4], Reactions: [24, 2], Views: [40, 4] },
  Facebook: { Followers: [35, 3], Likes: [35, 3], Views: [22, 2] },
  WhatsApp: { "Channel Members": [100, 10] },
  LinkedIn: { "AI Growth": [340, 35] }
};

const platformSelect = document.getElementById('platform');
const serviceSelect = document.getElementById('service');
const quantityInput = document.getElementById('quantity');
const priceGHS = document.getElementById('priceGHS');
const priceUSD = document.getElementById('priceUSD');

platformSelect.addEventListener('change', function() {
  serviceSelect.innerHTML = '<option value="">-- Select Service --</option>';
  const services = prices[this.value];
  if (services) {
    Object.keys(services).forEach(service => {
      const opt = document.createElement('option');
      opt.value = service;
      opt.textContent = service;
      serviceSelect.appendChild(opt);
    });
  }
});

function updatePrice() {
  const platform = platformSelect.value;
  const service = serviceSelect.value;
  const qty = parseInt(quantityInput.value);
  if (platform && service && qty > 0) {
    const [ghs, usd] = prices[platform][service];
    priceGHS.textContent = ghs * qty;
    priceUSD.textContent = usd * qty;
  }
}

serviceSelect.addEventListener('change', updatePrice);
quantityInput.addEventListener('input', updatePrice);

function payWithPaystack() {
  const email = document.getElementById('email').value;
  const amount = parseFloat(priceGHS.textContent) * 100; // in pesewas

  if (!email || amount <= 0) {
    alert("Please complete all fields and select a service.");
    return;
  }

  let handler = PaystackPop.setup({
    key: 'pk_live_ddbf47d168d6849ef29050ffc35c98a12e11e38b',
    email: email,
    amount: amount,
    currency: 'GHS',
    callback: function(response) {
      saveOrder(response.reference);
    },
    onClose: function() {
      alert('Transaction was not completed.');
    }
  });
  handler.openIframe();
}

function saveOrder(reference) {
  const scriptURL = "https://script.google.com/macros/s/AKfycbyu3FYRfcwzzvZTMSUyI_lv2U-p8u1GV6wilrsjXx9KO8V6OYxANQ6qF8QIE9yYARsQ/exec";
  const data = {
    platform: platformSelect.value,
    service: serviceSelect.value,
    quantity: quantityInput.value,
    priceGHS: priceGHS.textContent,
    priceUSD: priceUSD.textContent,
    username: document.getElementById('username').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value,
    reference: reference
  };

  fetch(scriptURL, { method: 'POST', body: JSON.stringify(data) })
    .then(res => alert("Order placed successfully!"))
    .catch(err => alert("Error saving order."));
}
</script>

</body>
</html>